<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>–ü–æ–≤–µ—Å–∏—Ç—å –ö–æ–ª–æ–±–∫–∞</title>
  <style>
    body { margin:0; padding:0; background:#111; overflow:hidden; }
    canvas { display:block; }
    #info { position:absolute; top:10px; left:10px; color:#fff; font-family:Arial; font-size:20px; z-index:10; }
    #score {
        position: absolute;
        top: 40px;
        left: 10px;
        color: #fff;
        font-family: Arial;
        font-size: 16px;
        z-index: 10;
    }
  </style>
  
  <!-- Phaser 3 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.80.1/phaser.min.js"></script>
  <!-- Matter.js (–≤—Å—Ç—Ä–æ–µ–Ω –≤ Phaser 3) -->
     <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#111111">

  <!-- iOS support -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <!-- –ò–∫–æ–Ω–∫–∞ –¥–ª—è –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö -->
  <link rel="icon" sizes="192x192" href="icons/icon-192.png">
  <link rel="icon" sizes="512x512" href="icons/icon-512.png">
</head>
<body>
  <div id="info">–ó–∞—Ç—è–Ω–∏ –ø–µ—Ç–ª—é!</div>
  <div id="score">–ü–æ–ø–∞–¥–∞–Ω–∏–π: <span>0</span> | –ü—Ä–æ–º–∞—Ö–æ–≤: <span>0</span></div>


  <script>
    const config = {
      type: Phaser.AUTO,
      width: window.innerWidth,
      height: window.innerHeight,
      physics: {
        default: 'matter',
        matter: {
          gravity: { y: 1 },
          debug: false // –ø–æ—Å—Ç–∞–≤—å true, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –≤–∏–¥–µ—Ç—å —Ö–∏—Ç–±–æ–∫—Å—ã
        }
      },
      scene: {
        preload: preload,
        create: create,
        update: update
      },
      backgroundColor: '#87CEEB'
    };

    const game = new Phaser.Game(config);

    let kolobok, rope, sling, hanging = false;
    let attempts = 3;
    let hits = 0;
let misses = 0;

    function preload() {
      // –ü—Ä–æ—Å—Ç—ã–µ –∑–∞–≥–ª—É—à–∫–∏ –≤–º–µ—Å—Ç–æ –∫–∞—Ä—Ç–∏–Ω–æ–∫
      this.load.image('kolobok', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI0NSIgZmlsbD0iI0ZGRDQwMCIvPjxjaXJjbGUgY3g9IjM1IiBjeT0iNDAiIHI9IjgiIGZpbGw9IiMwMDAiLz48Y2lyY2xlIGN4PSI2NSIgY3k9IjQwIiByPSI4IiBmaWxsPSIjjAwMCIvPjxwYXRoIGQ9Ik00MCA2MEM0NSA3NSA1NSA3NSA2MCA2MCIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjQiIGZpbGw9Im5vbmUiLz48L3N2Zz4=');
      this.load.image('rope', 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iMTAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGQ9Ik0zMCAxMEMzMCAxMCAzMCAxMDAgMzAgMTAwIiBzdHJva2U9IiM2RTJCMkYiIHN0cm9rZS13aWR0aD0iMjAiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIvPjwvc3ZnPg==');
    
    this.load.audio('hit', 'sounds/sound-1.wav');     // –ü–æ–ø–∞–¥–∞–Ω–∏–µ
  this.load.audio('miss', 'sounds/sound-2.wav');    // –°–º–µ—Ö/—Ä–∂–∞–Ω–∏–µ
  this.load.audio('rope', 'sounds/sound-3.wav');    // –°–≤–∏—Å—Ç/–±—Ä–æ—Å–æ–∫
}

    function create() {
      this.hitSound = this.sound.add('hit');
    this.missSound = this.sound.add('miss');
    this.ropeSound = this.sound.add('rope');
        this.input.touch.preventDefault = true;
      this.matter.world.setBounds(0, 0, config.width, config.height, 32, true, true, false, true);

      // –ó–µ–º–ª—è
      this.matter.add.rectangle(config.width/2, config.height - 20, config.width, 40, { isStatic: true });

      // –ö–æ–ª–æ–±–æ–∫
      kolobok = this.matter.add.sprite(200, config.height - 100, 'kolobok').setScale(1.2);
      kolobok.setBody({ type: 'circle', radius: 50 });
      kolobok.setBounce(0.8);
      kolobok.setVelocity(8, -10);

      // –†–æ–≥–∞—Ç–∫–∞ (—Å—Ç–∞—Ç–∏—á–Ω–∞—è)
      sling = this.add.rectangle(100, config.height - 150, 40, 40, 0x6E2B2F);
      this.matter.add.gameObject(sling).setStatic(true);

      // –ü–µ—Ç–ª—è (–Ω–∞—á–∞–ª—å–Ω–æ–µ –ø–æ–ª–æ–∂–µ–Ω–∏–µ —É —Ä–æ–≥–∞—Ç–∫–∏)
      rope = this.matter.add.sprite(100, config.height - 150, 'rope').setScale(0.8);
      rope.setBody({ type: 'circle', radius: 30 });
      rope.setBounce(0.3);

      // –°–æ–±—ã—Ç–∏—è –¥–ª—è —Ç–∞—á–∞/–º—ã—à–∏
      this.input.on('pointerdown', startDrag, this);
      this.input.on('pointerup', releaseDrag, this);

      // –¢–µ–∫—Å—Ç –ø–æ–ø—ã—Ç–æ–∫
      this.attemptText = this.add.text(10, 50, `–ü–æ–ø—ã—Ç–∫–∏: ${attempts}`, { fontSize: '24px', color: '#fff' });
      // –°–æ–∑–¥–∞—ë–º —Ç–µ–∫—Å—Ç –¥–ª—è —Å—á—ë—Ç–∞ (–æ–Ω –∑–∞–º–µ–Ω–∏—Ç HTML-—Å—á—ë—Ç—á–∏–∫)
this.scoreText = this.add.text(10, 80, `–ü–æ–ø–∞–¥–∞–Ω–∏–π: ${hits} | –ü—Ä–æ–º–∞—Ö–æ–≤: ${misses}`, { 
    fontSize: '20px', 
    color: '#fff',
    fontFamily: 'Arial'
});

// –û–±–Ω–æ–≤–ª—è–µ–º HTML-—Å—á—ë—Ç—á–∏–∫ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
document.getElementById('score').innerHTML = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: <span>${hits}</span> | –ü—Ä–æ–º–∞—Ö–æ–≤: <span>${misses}</span>`;
    }

    let pointerConstraint;
    function startDrag(pointer) {
      if (hanging) return;
      const dist = Phaser.Math.Distance.Between(pointer.x, pointer.y, rope.x, rope.y);
      if (dist < 100) {
        pointerConstraint = this.matter.add.pointerConstraint(pointer, rope, 0);
        this.ropeSound.play();
      }
    }

    function releaseDrag(pointer) {
      if (pointerConstraint) {
        this.matter.removeConstraint(pointerConstraint);
        pointerConstraint = null;
      }
    }

    function update() {
      if (hanging) return;

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø–∞–¥–∞–Ω–∏—è –ø–µ—Ç–ª–∏ –Ω–∞ –ö–æ–ª–æ–±–∫–∞
      const dist = Phaser.Math.Distance.Between(rope.x, rope.y, kolobok.x, kolobok.y);
      if (dist < 70 && !hanging) { // 70 ‚Äî —Ä–∞–¥–∏—É—Å –ö–æ–ª–æ–±–∫–∞ + –ø–µ—Ç–ª–∏
        hanging = true;
        hits++;
        updateScore.call(this);
        this.hitSound.play();
        const hitEmoji = this.add.text(kolobok.x, kolobok.y - 50, 'üòõüí•', {
    fontSize: '40px',
    color: '#ff0000'
}).setOrigin(0.5);

// –ê–Ω–∏–º–∞—Ü–∏—è —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è
this.tweens.add({
    targets: kolobok,
    scaleX: 0.5,
    angle: 90,
    duration: 1000
});

// –£–±–∏—Ä–∞–µ–º —ç–º–æ–¥–∑–∏ —á–µ—Ä–µ–∑ —Å–µ–∫—É–Ω–¥—É
this.time.delayedCall(1000, () => hitEmoji.destroy());

        // –§–∏–∫—Å–∏—Ä—É–µ–º –ö–æ–ª–æ–±–∫–∞ –∫ –ø–µ—Ç–ª–µ
        this.matter.add.constraint(rope.body, kolobok.body, 0, 1);

        // –ü–æ–¥–Ω–∏–º–∞–µ–º –≤–≤–µ—Ä—Ö (–∏–º–∏—Ç–∞—Ü–∏—è –∑–∞—Ç—è–≥–∏–≤–∞–Ω–∏—è)
        this.tweens.add({
          targets: rope,
          y: rope.y - 200,
          duration: 1500,
          ease: 'Power2'
        });

        this.tweens.add({
          targets: kolobok,
          y: kolobok.y - 200,
          duration: 1500,
          ease: 'Power2',
          onComplete: () => {
            this.add.text(config.width/2 - 150, config.height/2, '–ö–û–õ–û–ë–û–ö –ü–û–í–ï–®–ï–ù!', { fontSize: '48px', color: '#ff0000' }).setOrigin(0.5);
          }
        });

        // –ì–ª–∞–∑–∞ –∑–∞–∫–∞—Ç—ã–≤–∞—é—Ç—Å—è (–ø—Ä–æ—Å—Ç–∞—è –∞–Ω–∏–º–∞—Ü–∏—è)
        this.tweens.add({
          targets: kolobok,
          angle: 30,
          yoyo: true,
          repeat: -1,
          duration: 200
        });
      }

      // –ï—Å–ª–∏ –ö–æ–ª–æ–±–æ–∫ —É–∫–∞—Ç–∏–ª—Å—è –∑–∞ —ç–∫—Ä–∞–Ω ‚Äî –º–∏–Ω—É—Å –ø–æ–ø—ã—Ç–∫–∞
      if (kolobok.x > config.width + 200 && !hanging) {
        attempts--;
        misses++;
        updateScore.call(this);
        this.missSound.play();
        const missEmoji = this.add.text(kolobok.x, kolobok.y - 50, 'üòõüñï', {
    fontSize: '40px',
    color: '#ffff00'
}).setOrigin(0.5);

// –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–ø—Ä—ã–≥–∏–≤–∞–Ω–∏—è
this.tweens.add({
    targets: kolobok,
    y: kolobok.y - 100,
    duration: 300,
    yoyo: true
});

this.time.delayedCall(1000, () => missEmoji.destroy());
        this.attemptText.setText(`–ü–æ–ø—ã—Ç–∫–∏: ${attempts}`);
        if (attempts <= 0) {
          this.add.text(config.width/2 - 200, config.height/2, '–ö–æ–ª–æ–±–æ–∫ —Å–±–µ–∂–∞–ª! –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞', { fontSize: '36px', color: '#fff' }).setOrigin(0.5);
          hanging = true;
        } else {
          resetKolobok.call(this);
        }
      }
    }

    function resetKolobok() {
      kolobok.setPosition(200, config.height - 100);
      kolobok.setVelocity(8, -10);
      rope.setPosition(100, config.height - 150);
      rope.setVelocity(0, 0);
      hanging = false;
    }
    function updateScore() {
    if (this.scoreText) {
        this.scoreText.setText(`–ü–æ–ø–∞–¥–∞–Ω–∏–π: ${hits} | –ü—Ä–æ–º–∞—Ö–æ–≤: ${misses}`);
    }
    // –û–±–Ω–æ–≤–ª—è–µ–º HTML-—Å—á—ë—Ç—á–∏–∫
    document.getElementById('score').innerHTML = `–ü–æ–ø–∞–¥–∞–Ω–∏–π: <span>${hits}</span> | –ü—Ä–æ–º–∞—Ö–æ–≤: <span>${misses}</span>`;
}
    // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Service Worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('SW registered: ', reg))
          .catch(err => console.log('SW registration failed: ', err));
      });
    }
    window.addEventListener('blur', function() {
      if (game.scene.scenes[0]) game.scene.scenes[0].scene.pause();
    });
    window.addEventListener('focus', function() {
      if (game.scene.scenes[0]) game.scene.scenes[0].scene.resume();
    });
  </script>
</body>
</html>